{% comment %}
  Recently Viewed Products Widget Section
  Bu section anasayfada widget'ƒ± g√∂sterir
{% endcomment %}

{% if settings.show_recently_viewed_products %}
  <div class="recently-viewed-widget-section" style="padding: 40px 0;">
    <div class="page-width">
      <div class="section-header text-center" style="margin-bottom: 30px;">
        <h2 class="section-title" style="
          font-size: 28px;
          font-weight: 600;
          color: {{ settings.primary_color | default: '#000000' }};
          margin: 0 0 10px 0;
        ">
          {{ settings.widget_title | default: 'Son G√∂r√ºnt√ºlenen √úr√ºnler' }}
        </h2>
        <p class="section-description" style="
          font-size: 16px;
          color: #666;
          margin: 0;
          max-width: 600px;
          margin: 0 auto;
        ">
          M√º≈üterilerinizin en son g√∂r√ºnt√ºlediƒüi √ºr√ºnleri ke≈üfedin
        </p>
      </div>
      
      <!-- Widget Container -->
      <div id="recently-viewed-products-widget-homepage" 
           data-shop="{{ shop.permanent_domain }}"
           data-widget-config="{{ settings.widget_config | escape }}">
      </div>
      
      <!-- Widget Kapalƒ± Durum -->
      <div id="widget-closed-homepage" style="
        position: relative;
        background: {{ settings.background_color | default: '#ffffff' }};
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        padding: 20px;
        margin: 0 auto;
        max-width: 400px;
        cursor: pointer;
        font-family: {{ settings.font_family | default: 'Arial, sans-serif' }};
        font-size: {{ settings.font_size | default: 14 }}px;
        color: {{ settings.primary_color | default: '#000000' }};
        transition: all 0.3s ease;
        text-align: center;
      ">
        <div style="
          font-weight: bold; 
          margin-bottom: 12px;
          font-size: 18px;
        ">
          {{ settings.widget_title | default: 'Son G√∂r√ºnt√ºlenen √úr√ºnler' }}
        </div>
        <div style="
          font-size: 14px; 
          opacity: 0.7;
          margin-bottom: 16px;
        ">
          üëÅÔ∏è <span id="product-count-homepage">0</span> √ºr√ºn g√∂r√ºnt√ºlendi
        </div>
        <div style="
          font-size: 12px;
          color: #666;
          font-style: italic;
        ">
          √úr√ºn sayfalarƒ±nda gezinerek √ºr√ºnleri takip edin
        </div>
      </div>
      
      <!-- Demo √úr√ºnler (Eƒüer hen√ºz √ºr√ºn g√∂r√ºnt√ºlenmemi≈üse) -->
      <div id="demo-products-homepage" style="
        display: none;
        margin-top: 30px;
        text-align: center;
      ">
        <h3 style="margin: 0 0 20px 0; color: #666; font-size: 18px;">
          Hen√ºz √ºr√ºn g√∂r√ºnt√ºlenmemi≈ü
        </h3>
        <div style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 20px;
          max-width: 600px;
          margin: 0 auto;
        ">
          <div style="
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
          ">
            <div style="
              width: 80px;
              height: 80px;
              background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
              border-radius: 50%;
              margin: 0 auto 15px;
              display: flex;
              align-items: center;
              justify-content: center;
              color: white;
              font-size: 24px;
            ">
              üõçÔ∏è
            </div>
            <div style="font-weight: 500; margin-bottom: 8px;">Demo √úr√ºn 1</div>
            <div style="font-size: 14px; color: #666;">‚Ç∫99.99</div>
          </div>
          
          <div style="
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
          ">
            <div style="
              width: 80px;
              height: 80px;
              background: linear-gradient(45deg, #4ecdc4, #45b7d1);
              border-radius: 50%;
              margin: 0 auto 15px;
              display: flex;
              align-items: center;
              justify-content: center;
              color: white;
              font-size: 24px;
            ">
              üéØ
            </div>
            <div style="font-weight: 500; margin-bottom: 8px;">Demo √úr√ºn 2</div>
            <div style="font-size: 14px; color: #666;">‚Ç∫149.99</div>
          </div>
          
          <div style="
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
          ">
            <div style="
              width: 80px;
              height: 80px;
              background: linear-gradient(45deg, #45b7d1, #96ceb4);
              border-radius: 50%;
              margin: 0 auto 15px;
              display: flex;
              align-items: center;
              justify-content: center;
              color: white;
              font-size: 24px;
            ">
              üöÄ
            </div>
            <div style="font-weight: 500; margin-bottom: 8px;">Demo √úr√ºn 3</div>
            <div style="font-size: 14px; color: #666;">‚Ç∫199.99</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Anasayfa widget script'i
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Anasayfa widget y√ºklendi!');
      
      const productCount = document.getElementById('product-count-homepage');
      const demoProducts = document.getElementById('demo-products-homepage');
      const widgetClosed = document.getElementById('widget-closed-homepage');
      
      // localStorage'dan √ºr√ºnleri y√ºkle
      const recentProducts = JSON.parse(localStorage.getItem('recentlyViewedProducts') || '[]');
      
      if (productCount) {
        productCount.textContent = recentProducts.length;
      }
      
      // Eƒüer √ºr√ºn yoksa demo √ºr√ºnleri g√∂ster
      if (recentProducts.length === 0) {
        if (demoProducts) demoProducts.style.display = 'block';
        if (widgetClosed) widgetClosed.style.display = 'none';
      } else {
        if (demoProducts) demoProducts.style.display = 'none';
        if (widgetClosed) widgetClosed.style.display = 'block';
      }
      
      // Widget'a tƒ±klama olayƒ±
      if (widgetClosed) {
        widgetClosed.addEventListener('click', function() {
          // √úr√ºn sayfalarƒ±na y√∂nlendir
          if (recentProducts.length > 0) {
            window.location.href = recentProducts[0].url;
          } else {
            window.location.href = '/collections/all';
          }
        });
      }
      
      // localStorage deƒüi≈üikliklerini dinle
      window.addEventListener('storage', function(e) {
        if (e.key === 'recentlyViewedProducts') {
          const updatedProducts = JSON.parse(e.newValue || '[]');
          if (productCount) {
            productCount.textContent = updatedProducts.length;
          }
          
          if (updatedProducts.length === 0) {
            if (demoProducts) demoProducts.style.display = 'block';
            if (widgetClosed) widgetClosed.style.display = 'none';
          } else {
            if (demoProducts) demoProducts.style.display = 'none';
            if (widgetClosed) widgetClosed.style.display = 'block';
          }
        }
      });
    });
  </script>
{% endif %}

{% schema %}
{
  "name": "Recently Viewed Widget",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
              "content": "Widget Visibility"
    },
    {
      "type": "checkbox",
      "id": "show_recently_viewed_products",
             "label": "Show Widget",
      "default": true
    },
    {
      "type": "header",
              "content": "Appearance Settings"
    },
    {
      "type": "text",
      "id": "widget_title",
             "label": "Widget Title",
      "default": "Son G√∂r√ºnt√ºlenen √úr√ºnler"
    },
    {
      "type": "color",
      "id": "primary_color",
             "label": "Primary Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "background_color",
             "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "font_size",
             "label": "Font Size",
      "min": 12,
      "max": 20,
      "step": 1,
      "default": 14,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "font_family",
             "label": "Font Family",
      "options": [
        {
          "value": "Arial, sans-serif",
          "label": "Arial"
        },
        {
          "value": "Helvetica, sans-serif",
          "label": "Helvetica"
        },
        {
          "value": "Georgia, serif",
          "label": "Georgia"
        },
        {
          "value": "Times New Roman, serif",
          "label": "Times New Roman"
        }
      ],
      "default": "Arial, sans-serif"
    }
  ],
  "presets": [
    {
      "name": "Recently Viewed Products Widget"
    }
  ]
}
{% endschema %}
